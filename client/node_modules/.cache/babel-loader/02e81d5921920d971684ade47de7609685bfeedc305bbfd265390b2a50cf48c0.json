{"ast":null,"code":"// Tax rates by jurisdiction\nexport const taxRates = {\n  'US-CA': {\n    rate: 8.5,\n    name: 'California'\n  },\n  'US-NY': {\n    rate: 8.875,\n    name: 'New York'\n  },\n  'US-TX': {\n    rate: 6.25,\n    name: 'Texas'\n  },\n  'US-FL': {\n    rate: 6.0,\n    name: 'Florida'\n  },\n  'CA-ON': {\n    rate: 13.0,\n    name: 'Ontario'\n  },\n  'CA-BC': {\n    rate: 12.0,\n    name: 'British Columbia'\n  },\n  'CA-QC': {\n    rate: 14.975,\n    name: 'Quebec'\n  },\n  'UK-': {\n    rate: 20.0,\n    name: 'United Kingdom'\n  }\n};\n\n// Tax exemption rules\nexport const taxRules = {\n  'US-CA': [{\n    name: 'Digital Products Exemption',\n    description: 'Some digital products are exempt from sales tax in California',\n    applies: product => ['E-book', 'Digital Media'].includes(product.type),\n    modify: rate => 0 // Exempt\n  }, {\n    name: 'SaaS Rule',\n    description: 'SaaS products are taxable in California',\n    applies: product => product.type === 'Digital Software' && product.name.toLowerCase().includes('saas'),\n    modify: rate => rate // Standard rate\n  }],\n  'US-NY': [{\n    name: 'Educational Materials Exemption',\n    description: 'Educational materials are exempt from sales tax in New York',\n    applies: product => product.type === 'E-book' && product.name.toLowerCase().includes('education'),\n    modify: rate => 0 // Exempt\n  }]\n};\n\n// Calculate tax for a set of products\nexport const calculateTax = (products, customerLocation) => {\n  var _taxRates$locationKey, _taxRates$locationKey2;\n  // Calculate subtotal\n  const subtotal = products.reduce((sum, product) => sum + parseFloat(product.price) * parseInt(product.quantity), 0);\n\n  // Determine tax rate based on location\n  const locationKey = `${customerLocation.country}-${customerLocation.state || ''}`;\n\n  // Apply tax rules for each product\n  let totalTaxAmount = 0;\n  for (const product of products) {\n    const productSubtotal = parseFloat(product.price) * parseInt(product.quantity);\n    const taxAmount = calculateTaxWithRules(product, customerLocation, productSubtotal);\n    totalTaxAmount += taxAmount;\n  }\n  const total = subtotal + totalTaxAmount;\n  const jurisdictionName = ((_taxRates$locationKey = taxRates[locationKey]) === null || _taxRates$locationKey === void 0 ? void 0 : _taxRates$locationKey.name) || 'Unknown';\n  return {\n    subtotal: subtotal.toFixed(2),\n    taxRate: ((_taxRates$locationKey2 = taxRates[locationKey]) === null || _taxRates$locationKey2 === void 0 ? void 0 : _taxRates$locationKey2.rate) || 0,\n    taxAmount: totalTaxAmount.toFixed(2),\n    total: total.toFixed(2),\n    jurisdiction: jurisdictionName\n  };\n};\n\n// Apply tax rules to a specific product\nexport const calculateTaxWithRules = (product, customerLocation, subtotal = null) => {\n  var _taxRates$locationKey3;\n  const locationKey = `${customerLocation.country}-${customerLocation.state || ''}`;\n  const baseRate = ((_taxRates$locationKey3 = taxRates[locationKey]) === null || _taxRates$locationKey3 === void 0 ? void 0 : _taxRates$locationKey3.rate) || 0;\n  const rules = taxRules[locationKey] || [];\n\n  // If no subtotal provided, calculate it\n  const productSubtotal = subtotal !== null ? subtotal : parseFloat(product.price) * parseInt(product.quantity);\n\n  // Check if any rules apply to this product\n  for (const rule of rules) {\n    if (rule.applies(product)) {\n      const modifiedRate = rule.modify(baseRate);\n      return productSubtotal * modifiedRate / 100;\n    }\n  }\n\n  // No rules apply, use standard rate\n  return productSubtotal * baseRate / 100;\n};\n\n// Economic nexus thresholds by jurisdiction\nexport const nexusThresholds = {\n  'US-CA': {\n    revenue: 500000,\n    transactions: 0\n  },\n  'US-NY': {\n    revenue: 500000,\n    transactions: 100\n  },\n  'US-TX': {\n    revenue: 500000,\n    transactions: 0\n  },\n  'US-FL': {\n    revenue: 100000,\n    transactions: 200\n  }\n};\n\n// Determine if company has nexus in a jurisdiction\nexport const determineNexus = (company, jurisdiction) => {\n  if (!nexusThresholds[jurisdiction]) {\n    return false;\n  }\n\n  // Check if company exceeds thresholds\n  const stateData = company.salesByState[jurisdiction] || {\n    revenue: 0,\n    transactions: 0\n  };\n  const threshold = nexusThresholds[jurisdiction];\n  if (!threshold) return false;\n  return stateData.revenue >= threshold.revenue || threshold.transactions > 0 && stateData.transactions >= threshold.transactions;\n};\n\n// Calculate VAT for international sales\nexport const calculateVAT = (product, customerLocation) => {\n  const vatRates = {\n    'UK': 20,\n    'EU-DE': 19,\n    'EU-FR': 20,\n    'EU-ES': 21\n  };\n\n  // B2B vs B2C determination (affects VAT in EU)\n  const isB2B = customerLocation.vatId ? true : false;\n\n  // Reverse charge mechanism for B2B within EU\n  if (isB2B && customerLocation.country.startsWith('EU-')) {\n    return 0; // Reverse charge applies\n  }\n  return vatRates[customerLocation.country] || 0;\n};","map":{"version":3,"names":["taxRates","rate","name","taxRules","description","applies","product","includes","type","modify","toLowerCase","calculateTax","products","customerLocation","_taxRates$locationKey","_taxRates$locationKey2","subtotal","reduce","sum","parseFloat","price","parseInt","quantity","locationKey","country","state","totalTaxAmount","productSubtotal","taxAmount","calculateTaxWithRules","total","jurisdictionName","toFixed","taxRate","jurisdiction","_taxRates$locationKey3","baseRate","rules","rule","modifiedRate","nexusThresholds","revenue","transactions","determineNexus","company","stateData","salesByState","threshold","calculateVAT","vatRates","isB2B","vatId","startsWith"],"sources":["/Users/clarafication/Desktop/MY NEW NEW COMPUTER/Coding/E-Commerce-Tax-Calculator/client/src/services/TaxCalculation/taxCalculationService.js"],"sourcesContent":["// Tax rates by jurisdiction\nexport const taxRates = {\n  'US-CA': { rate: 8.5, name: 'California' },\n  'US-NY': { rate: 8.875, name: 'New York' },\n  'US-TX': { rate: 6.25, name: 'Texas' },\n  'US-FL': { rate: 6.0, name: 'Florida' },\n  'CA-ON': { rate: 13.0, name: 'Ontario' },\n  'CA-BC': { rate: 12.0, name: 'British Columbia' },\n  'CA-QC': { rate: 14.975, name: 'Quebec' },\n  'UK-': { rate: 20.0, name: 'United Kingdom' },\n};\n\n// Tax exemption rules\nexport const taxRules = {\n  'US-CA': [\n    { \n      name: 'Digital Products Exemption',\n      description: 'Some digital products are exempt from sales tax in California',\n      applies: (product) => ['E-book', 'Digital Media'].includes(product.type),\n      modify: (rate) => 0 // Exempt\n    },\n    {\n      name: 'SaaS Rule',\n      description: 'SaaS products are taxable in California',\n      applies: (product) => \n        product.type === 'Digital Software' && \n        product.name.toLowerCase().includes('saas'),\n      modify: (rate) => rate // Standard rate\n    }\n  ],\n  'US-NY': [\n    {\n      name: 'Educational Materials Exemption',\n      description: 'Educational materials are exempt from sales tax in New York',\n      applies: (product) => \n        product.type === 'E-book' && \n        product.name.toLowerCase().includes('education'),\n      modify: (rate) => 0 // Exempt\n    }\n  ]\n};\n\n// Calculate tax for a set of products\nexport const calculateTax = (products, customerLocation) => {\n  // Calculate subtotal\n  const subtotal = products.reduce(\n    (sum, product) => sum + (parseFloat(product.price) * parseInt(product.quantity)),\n    0\n  );\n  \n  // Determine tax rate based on location\n  const locationKey = `${customerLocation.country}-${customerLocation.state || ''}`;\n  \n  // Apply tax rules for each product\n  let totalTaxAmount = 0;\n  \n  for (const product of products) {\n    const productSubtotal = parseFloat(product.price) * parseInt(product.quantity);\n    const taxAmount = calculateTaxWithRules(product, customerLocation, productSubtotal);\n    totalTaxAmount += taxAmount;\n  }\n  \n  const total = subtotal + totalTaxAmount;\n  const jurisdictionName = taxRates[locationKey]?.name || 'Unknown';\n  \n  return {\n    subtotal: subtotal.toFixed(2),\n    taxRate: taxRates[locationKey]?.rate || 0,\n    taxAmount: totalTaxAmount.toFixed(2),\n    total: total.toFixed(2),\n    jurisdiction: jurisdictionName,\n  };\n};\n\n// Apply tax rules to a specific product\nexport const calculateTaxWithRules = (product, customerLocation, subtotal = null) => {\n  const locationKey = `${customerLocation.country}-${customerLocation.state || ''}`;\n  const baseRate = taxRates[locationKey]?.rate || 0;\n  const rules = taxRules[locationKey] || [];\n  \n  // If no subtotal provided, calculate it\n  const productSubtotal = subtotal !== null ? \n    subtotal : \n    parseFloat(product.price) * parseInt(product.quantity);\n  \n  // Check if any rules apply to this product\n  for (const rule of rules) {\n    if (rule.applies(product)) {\n      const modifiedRate = rule.modify(baseRate);\n      return (productSubtotal * modifiedRate) / 100;\n    }\n  }\n  \n  // No rules apply, use standard rate\n  return (productSubtotal * baseRate) / 100;\n};\n\n// Economic nexus thresholds by jurisdiction\nexport const nexusThresholds = {\n  'US-CA': { revenue: 500000, transactions: 0 },\n  'US-NY': { revenue: 500000, transactions: 100 },\n  'US-TX': { revenue: 500000, transactions: 0 },\n  'US-FL': { revenue: 100000, transactions: 200 }\n};\n\n// Determine if company has nexus in a jurisdiction\nexport const determineNexus = (company, jurisdiction) => {\n  if (!nexusThresholds[jurisdiction]) {\n    return false;\n  }\n  \n  // Check if company exceeds thresholds\n  const stateData = company.salesByState[jurisdiction] || { revenue: 0, transactions: 0 };\n  const threshold = nexusThresholds[jurisdiction];\n  \n  if (!threshold) return false;\n  \n  return stateData.revenue >= threshold.revenue || \n         (threshold.transactions > 0 && stateData.transactions >= threshold.transactions);\n};\n\n// Calculate VAT for international sales\nexport const calculateVAT = (product, customerLocation) => {\n  const vatRates = {\n    'UK': 20,\n    'EU-DE': 19,\n    'EU-FR': 20,\n    'EU-ES': 21\n  };\n  \n  // B2B vs B2C determination (affects VAT in EU)\n  const isB2B = customerLocation.vatId ? true : false;\n  \n  // Reverse charge mechanism for B2B within EU\n  if (isB2B && customerLocation.country.startsWith('EU-')) {\n    return 0; // Reverse charge applies\n  }\n  \n  return vatRates[customerLocation.country] || 0;\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}